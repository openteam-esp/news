<% if @current_user != @entry.initiator %>
  <% if @current_user.subscribed?(@entry.initiator) %>
    <%= link_to t('unsubscribe_to_news_from_this_author'), delete_subscribe_path(@entry), :method => :delete, :class => :button %>
  <% else %>
    <%= link_to t('subscribe_to_news_from_this_author'), subscribe_path(@entry), :class => :button %>
  <% end %>
<% end %>

<h2 <%= 'class=empty' if @entry.title.blank? %>><%= @entry.title.present? ? raw(@entry.title.gsub('&quot;', '"').gilensize) : t('empty_title') %></h2>

<div class='annotation <%= "empty" if @entry.annotation.blank? %>'>
  <%= @entry.annotation.present? ? raw(@entry.annotation.gsub('&quot;', '"').gilensize) : t('empty_annotation') %>
</div>

<div class='body'>
  <%= raw @entry.body.gsub('&quot;', '"').gilensize %>
</div>

<div class='channels'>
  <h2><%= t('channels') %></h2>
  <ul>
    <% if @entry.channels.any? %>
      <% @entry.channels.each do |channel| %>
        <li><%= channel.title %></li>
      <% end %>
    <% else %>
      <%= content_tag :li, t('not_any_channels'), :class => 'empty' %>
    <% end %>
  </ul>
</div>

<div class='availability'>
  <h2><%= t('availability') %></h2>
  <ul>
    <li><%= @entry.since ? "#{t('since')} #{l(@entry.since, :format => :long)}" : t('immediately_after_correcting') %></li>
    <li><%= @entry.until ? "#{t('until')} #{l(@entry.until, :format => :long)}" : t('not_limited_in_time') %></li>
  </ul>
</div>

<div class='modification'>
  <h2><%= t('i_want_to_change_the_news') %></h2>
  <%= semantic_form_for :event, :url => folder_entry_events_path(@folder, @entry) do |form| %>
    <%= form.inputs do %>
      <%= form.input :type, :as => :hidden, :value => 'modification'%>
      <%= form.input :user_id, :as => :hidden, :value => current_user.id %>
      <%= form.input :text, :as => :text %>
    <% end %>
    <%= form.buttons do %>
      <%= form.commit_button t('modification'), :button_html => { :class => "button" } %>
    <% end %>
  <% end %>
</div>

<div class='actions'>
  <h2><%= t('actions') %></h2>
  <ul>
    <% @entry.state_events_for(current_user).each do |event| %>
      <li>
        <h3><%= t "event.kind.before.#{event}" %></h3>
        <%= semantic_form_for :event, :url => folder_entry_events_path(@folder, @entry) do |form| %>
          <%= form.inputs do %>
            <%= form.input :kind, :as => :hidden, :value => event %>
            <%= form.input :user_id, :as => :hidden, :value => current_user.id %>
            <%= form.input :text, :as => :text %>
          <% end %>
          <%= form.buttons do %>
            <%= form.commit_button t(event.to_s), :button_html => { :class => "button" } %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div class='history'>
  <h2><%= t('history') %></h2>
  <ul>
    <% @entry.events.each do |event| %>
      <li>
        <%= l event.created_at, :format => :long %>
        <%= t "event.kind.after.#{event.kind}" %>
        <%= "#{event.user}" %>
        <%= link_to t('show_verison'), [@folder, @entry, event, event.version] if event.version %>
        <%= content_tag :span, event.text, :class => 'text' if event.text.present? %>
      </li>
    <% end %>
  </ul>
</div>

<p class="actions">
  <%= link_to t('edit'), edit_folder_entry_path(@folder, @entry) %>
  <%= link_to t('back'), folder_entries_path(@folder) %>
</p>

