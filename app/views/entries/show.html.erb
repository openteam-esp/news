<% if @current_user != @entry.initiator %>
  <% if @current_user.subscribed?(@entry.initiator) %>
    <%= link_to t('unsubscribe_to_news_from_this_author'), delete_subscribe_path(@entry), :method => :delete, :class => :button %>
  <% else %>
    <%= link_to t('subscribe_to_news_from_this_author'), subscribe_path(@entry), :class => :button %>
  <% end %>
<% end %>

<%= render :partial => 'entries/entry', :object => @entry %>

<div class='channels'>
  <h2><%= t('channels') %></h2>
  <ul>
    <% if @entry.channels.any? %>
      <% @entry.channels.each do |channel| %>
        <li><%= channel.title %></li>
      <% end %>
    <% else %>
      <%= content_tag :li, t('not_any_channels'), :class => 'empty' %>
    <% end %>
  </ul>
</div>

<div class='modification'>
  <h2><%= t('i_want_to_change_the_news') %></h2>
  <%= semantic_form_for :event, :url => folder_entry_events_path(@folder, @entry) do |form| %>
    <%= form.inputs do %>
      <%= form.input :type, :as => :hidden, :value => 'modification'%>
      <%= form.input :user_id, :as => :hidden, :value => current_user.id %>
      <%= form.input :text, :as => :text %>
    <% end %>
    <%= form.buttons do %>
      <%= form.commit_button t('modification'), :button_html => { :class => "button" } %>
    <% end %>
  <% end %>
</div>

<div class='actions'>
  <h2><%= t('actions') %></h2>
  <ul>
    <% @entry.state_events_for(current_user).each do |event| %>
      <li>
        <h3><%= t "event.kind.before.#{event}" %></h3>
        <%= semantic_form_for :event, :url => folder_entry_events_path(@folder, @entry) do |form| %>
          <%= form.inputs do %>
            <%= form.input :kind, :as => :hidden, :value => event %>
            <%= form.input :user_id, :as => :hidden, :value => current_user.id %>
            <%= form.input :text, :as => :text %>
          <% end %>
          <%= form.buttons do %>
            <%= form.commit_button t(event.to_s), :button_html => { :class => "button" } %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div class='history'>
  <h2><%= t('history') %></h2>
  <ul>
    <% @entry.events.each do |event| %>
      <li>
        <%= t "event.kind.after.#{event.kind}" %>
        <%= time_ago_in_words(event.created_at) %> назад
        <%= "#{event.user}" %>
        <% if event.version %>
          (<%= link_to t('show_version'), [@folder, @entry, event, event.version] %>)
        <% end %>
        <%= content_tag :span, event.text, :class => 'text' if event.text.present? %>
      </li>
    <% end %>
  </ul>
</div>

<p class="actions">
  <%= link_to t('edit'), edit_folder_entry_path(@folder, @entry) %>
  <%= link_to t('back'), folder_entries_path(@folder) %>
</p>

